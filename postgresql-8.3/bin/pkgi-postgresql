<?php echo "#!/bin/bash"; ?>

case ${1} in

    -i | init)
    
    . <?php echo getenv('APPNAME_HOME') ?>/etc/profile
    /usr/lib/postgresql/${PGVERSION}/bin/initdb
    rm -f <?php echo getenv('APPNAME_HOME') ?>/var/lib/postgresql/${PGVERSION}/main/postgresql.conf
    rm -f <?php echo getenv('APPNAME_HOME') ?>/var/lib/postgresql/${PGVERSION}/main/pg_hba.conf
    rm -f <?php echo getenv('APPNAME_HOME') ?>/var/lib/postgresql/${PGVERSION}/main/pg_ident.conf
    ln -s <?php echo getenv('APPNAME_HOME') ?>/etc/postgresql/${PGVERSION}/main/postgresql.conf <?php echo getenv('APPNAME_HOME') ?>/var/lib/postgresql/${PGVERSION}/main/postgresql.conf
    ln -s <?php echo getenv('APPNAME_HOME') ?>/etc/postgresql/${PGVERSION}/main/pg_hba.conf     <?php echo getenv('APPNAME_HOME') ?>/var/lib/postgresql/${PGVERSION}/main/pg_hba.conf
    ln -s <?php echo getenv('APPNAME_HOME') ?>/etc/postgresql/${PGVERSION}/main/pg_ident.conf   <?php echo getenv('APPNAME_HOME') ?>/var/lib/postgresql/${PGVERSION}/main/pg_ident.conf
    <?php echo getenv('APPNAME_HOME') ?>/etc/init.d/postgresql-${PGVERSION} start
    /usr/lib/postgresql/${PGVERSION}/bin/createdb -E UNICODE ${PGDATABASE}
    echo "Database ${PGDATABASE} created."
    <?php echo getenv('APPNAME_HOME') ?>/etc/init.d/postgresql-${PGVERSION} stop
    ;;

    *)
    # parametre invalide

    echo "usage: $0 ( init )"
    cat <<EOF
   -i  | init         - Initialisation de la base
EOF

    exit 1
    ;;
esac

exit 0
